import { FablerModifier } from "../core/fabler-modifier.js";
import OpenAI from "openai";
import * as console from "node:console";

// Dummy data table for input lookup
const dataTable: { [key: string]: string } = {
  "look around": "look",
  "scooby": "look",
  "look": "look",
"take a look": "look",
"glance around": "look",
"peer": "look",
"examine": "look",
"inspect": "look",
"scan the area": "look",
"survey the surroundings": "look",
"check out": "look",
"stare at": "look",
"observe": "look",
"take in the scene": "look",
"peek": "look",
"gaze": "look",
"spot": "look",
"watch closely": "look",
"focus on": "look",
"view": "look",
"get a good look": "look",
"fix your eyes on": "look",
"glimpse": "look",
"notice": "look",
"regard": "look",
"take a glance": "look",
"eyeball": "look",
"check out the details": "look",
"scrutinize": "look",
"search visually": "look",
"look closely": "look",
"take a gander": "look",
"cast your eyes": "look",
"direct your gaze": "look",
"ogle": "look",
"give a once-over": "look",
"check out the surroundings": "look",
"glance over": "look",
"peer around": "look",
"give it a look": "look",
"take a moment to observe": "look",
"glance about": "look",
"sweep your gaze": "look",
"take a brief look": "look",
"look over": "look",
"glance quickly": "look",
"watch carefully": "look",
"check visually": "look",
"focus intently": "look",
"view the surroundings": "look",
"look in the hole": "examine hole",
"take in your surroundings": "look",
"peer into the distance": "look",
"examine closely": "look",
"look carefully": "look",
"cast a glance": "look",
"look intently": "look",
"turn your eyes towards": "look",
"watch": "look",
"gather information visually": "look",
"give a quick glance": "look",
"scan": "look",
"glance briefly": "look",
"take a quick look": "look",
"give a thorough glance": "look",
"observe the area": "look",
"take a long, hard look": "look",
"give the scene a glance": "look",
"cast a curious glance": "look",
"inspect the environment": "look",
"survey the entire room": "look",
"peer into the shadows": "look",
"take a brief glance": "look",
"look towards the horizon": "look",
"take in every detail": "look",
"watch the surroundings": "look",
"fix your gaze on the object": "look",
"give a slow, deliberate look": "look",
"glance at the nearby objects": "look",
"give a quick once-over": "look",
"scan the horizon": "look",
"inspect the nearby area": "look",
"take a deep look around": "look",
"give a lingering look": "look",
"cast a long gaze over": "look",
"stare into the distance": "look",
"glance at your surroundings": "look",
"gaze at the scenery": "look",
"peer into the distance cautiously": "look",
"observe the details closely": "look",
"look at the object carefully": "look",
"give a fleeting glance": "look",
"survey the space quickly": "look",
"peer at the fine details": "look",
"inspect the scene thoroughly": "look",
"scan the objects carefully": "look",
"examine the room attentively": "look",
"glance over at the figure": "look",
"take a slow look around": "look",
"look deeply into the shadows": "look",
"glance at the far corner": "look",
"inspect the nearby items": "look",
"take a careful look around": "look",
"gaze out across the landscape": "look",
"give a slow, thoughtful look": "look",
"scan the room quickly": "look",
"glance towards the door": "look",
"take a slow look at the surroundings": "look",
"peer into the depths": "look",
"observe the room cautiously": "look",
"give the room a good look": "look",
"survey the scene intently": "look",
"inspect the corners carefully": "look",
"glance over the space quickly": "look",
"take a close look at the details": "look",
"watch the area with interest": "look",
"peer at the strange object": "look",
"glance towards the light": "look",
"examine the surroundings closely": "look",
"take a good, long look around": "look",
"look carefully at the object": "look",
"east": "east",
"e": "east",
"head east": "go east",
"move east": "go east",
"proceed eastward": "go east",
"walk to the east": "go east",
"make your way east": "go east",
"travel east": "go east",
"advance east": "go east",
"continue east": "go east",
"march east": "go east",
"step east": "go east",
"turn east": "go east",
"venture east": "go east",
"head towards the east": "go east",
"move in an easterly direction": "go east",
"proceed toward the east": "go east",
"go in the direction of east": "go east",
"walk eastward": "go east",
"journey east": "go east",
"step towards the east": "go east",
"press on east": "go east",
"head off east": "go east",
"wander east": "go east",
"push east": "go east",
"march toward the east": "go east",
"continue in the direction of east": "go east",
"proceed in the direction of east": "go east",
"move toward the eastern horizon": "go east",
"walk off to the east": "go east",
"start walking east": "go east",
"turn to the east and go": "go east",
"head directly east": "go east",
"take the path east": "go east",
"move straight east": "go east",
"walk straight east": "go east",
"take steps east": "go east",
"move over to the east": "go east",
"stride east": "go east",
"navigate east": "go east",
"take your path east": "go east",
"begin heading east": "go east",
"start moving east": "go east",
"proceed in an easterly direction": "go east",
"head eastward": "go east",
"tread east": "go east",
"travel in the direction of east": "go east",
"start your journey east": "go east",
"walk over to the east": "go east",
"continue your path east": "go east",
"make your way towards the east": "go east",
"shift east": "go east",
"progress east": "go east",
"stride toward the east": "go east",
"head off towards the east": "go east",
"walk east on the path": "go east",
"start walking toward the east": "go east",
"proceed to go east": "go east",
"push onward to the east": "go east",
"head in the direction of the east": "go east",
"keep going east": "go east",
"journey toward the east": "go east",
"walk forward east": "go east",
"start moving toward the east": "go east",
"continue forward to the east": "go east",
"set off to the east": "go east",
"make progress east": "go east",
"move toward the east side": "go east",
"head in an easterly direction": "go east",
"turn to the east and proceed": "go east",
"walk east across the path": "go east",
"venture toward the east": "go east",
"move to the east side": "go east",
"head straight toward the east": "go east",
"set your course east": "go east",
"step forward east": "go east",
"move east on the trail": "go east",
"move directly east": "go east",
"move eastward": "go east",
"head on east": "go east",
"travel eastward": "go east",
"journey in an easterly direction": "go east",
"start to head east": "go east",
"move ahead east": "go east",
"continue heading east": "go east",
"set out east": "go east",
"venture forth east": "go east",
"turn and walk east": "go east",
"proceed to the east side": "go east",
"march eastward": "go east",
"walk east toward the horizon": "go east",
"move on east": "go east",
"make progress toward the east": "go east",
"travel in the direction of the east": "go east",
"take the road east": "go east",
"continue walking east": "go east",
"set off toward the east": "go east",
"proceed east on the trail": "go east",
"head east along the path": "go east",
"move east along the road": "go east",
"head for the east": "go east",
"start toward the east": "go east",
"continue onward east": "go east",
"take the eastern path": "go east",
"keep moving east": "go east",
"head west": "go west",
"weast": "west",
"w": "west",
"move west": "go west",
"proceed westward": "go west",
"walk to the west": "go west",
"make your way west": "go west",
"travel west": "go west",
"advance west": "go west",
"continue west": "go west",
"march west": "go west",
"step west": "go west",
"turn west": "go west",
"venture west": "go west",
"head towards the west": "go west",
"move in a westerly direction": "go west",
"proceed toward the west": "go west",
"go in the direction of west": "go west",
"walk westward": "go west",
"journey west": "go west",
"step towards the west": "go west",
"press on west": "go west",
"head off west": "go west",
"wander west": "go west",
"push west": "go west",
"march toward the west": "go west",
"continue in the direction of west": "go west",
"proceed in the direction of west": "go west",
"move toward the western horizon": "go west",
"walk off to the west": "go west",
"start walking west": "go west",
"turn to the west and go": "go west",
"head directly west": "go west",
"take the path west": "go west",
"move straight west": "go west",
"walk straight west": "go west",
"take steps west": "go west",
"move over to the west": "go west",
"stride west": "go west",
"navigate west": "go west",
"take your path west": "go west",
"begin heading west": "go west",
"start moving west": "go west",
"proceed in a westerly direction": "go west",
"head westward": "go west",
"tread west": "go west",
"travel in the direction of west": "go west",
"start your journey west": "go west",
"walk over to the west": "go west",
"continue your path west": "go west",
"make your way towards the west": "go west",
"shift west": "go west",
"progress west": "go west",
"stride toward the west": "go west",
"head off towards the west": "go west",
"walk west on the path": "go west",
"start walking toward the west": "go west",
"proceed to go west": "go west",
"push onward to the west": "go west",
"head in the direction of the west": "go west",
"keep going west": "go west",
"journey toward the west": "go west",
"walk forward west": "go west",
"start moving toward the west": "go west",
"continue forward to the west": "go west",
"set off to the west": "go west",
"make progress west": "go west",
"move toward the west side": "go west",
"head in a westerly direction": "go west",
"turn to the west and proceed": "go west",
"walk west across the path": "go west",
"venture toward the west": "go west",
"move to the west side": "go west",
"head straight toward the west": "go west",
"set your course west": "go west",
"step forward west": "go west",
"move west on the trail": "go west",
"move directly west": "go west",
"move westward": "go west",
"head on west": "go west",
"travel westward": "go west",
"journey in a westerly direction": "go west",
"start to head west": "go west",
"move ahead west": "go west",
"continue heading west": "go west",
"set out west": "go west",
"venture forth west": "go west",
"turn and walk west": "go west",
"proceed to the west side": "go west",
"march westward": "go west",
"walk west toward the horizon": "go west",
"move on west": "go west",
"make progress toward the west": "go west",
"travel in the direction of the west": "go west",
"take the road west": "go west",
"continue walking west": "go west",
"set off toward the west": "go west",
"proceed west on the trail": "go west",
"head west along the path": "go west",
"move west along the road": "go west",
"head for the west": "go west",
"start toward the west": "go west",
"continue onward west": "go west",
"take the western path": "go west",
"keep moving west": "go west",
"head north": "go north",
"north": "north",
"n": "north",
"move north": "go north",
"proceed northward": "go north",
"walk to the north": "go north",
"make your way north": "go north",
"travel north": "go north",
"advance north": "go north",
"continue north": "go north",
"march north": "go north",
"step north": "go north",
"turn north": "go north",
"venture north": "go north",
"head towards the north": "go north",
"move in a northerly direction": "go north",
"proceed toward the north": "go north",
"go in the direction of north": "go north",
"walk northward": "go north",
"journey north": "go north",
"step towards the north": "go north",
"press on north": "go north",
"head off north": "go north",
"wander north": "go north",
"push north": "go north",
"march toward the north": "go north",
"continue in the direction of north": "go north",
"proceed in the direction of north": "go north",
"move toward the northern horizon": "go north",
"walk off to the north": "go north",
"start walking north": "go north",
"turn to the north and go": "go north",
"head directly north": "go north",
"take the path north": "go north",
"move straight north": "go north",
"walk straight north": "go north",
"take steps north": "go north",
"move over to the north": "go north",
"stride north": "go north",
"navigate north": "go north",
"take your path north": "go north",
"begin heading north": "go north",
"start moving north": "go north",
"proceed in a northerly direction": "go north",
"head northward": "go north",
"tread north": "go north",
"travel in the direction of north": "go north",
"start your journey north": "go north",
"walk over to the north": "go north",
"continue your path north": "go north",
"make your way towards the north": "go north",
"shift north": "go north",
"progress north": "go north",
"stride toward the north": "go north",
"head off towards the north": "go north",
"walk north on the path": "go north",
"start walking toward the north": "go north",
"proceed to go north": "go north",
"push onward to the north": "go north",
"head in the direction of the north": "go north",
"keep going north": "go north",
"journey toward the north": "go north",
"walk forward north": "go north",
"start moving toward the north": "go north",
"continue forward to the north": "go north",
"set off to the north": "go north",
"make progress north": "go north",
"move toward the north side": "go north",
"head in a northerly direction": "go north",
"turn to the north and proceed": "go north",
"walk north across the path": "go north",
"venture toward the north": "go north",
"move to the north side": "go north",
"head straight toward the north": "go north",
"set your course north": "go north",
"step forward north": "go north",
"move north on the trail": "go north",
"move directly north": "go north",
"move northward": "go north",
"head on north": "go north",
"travel northward": "go north",
"journey in a northerly direction": "go north",
"start to head north": "go north",
"move ahead north": "go north",
"continue heading north": "go north",
"set out north": "go north",
"venture forth north": "go north",
"turn and walk north": "go north",
"proceed to the north side": "go north",
"march northward": "go north",
"walk north toward the horizon": "go north",
"move on north": "go north",
"make progress toward the north": "go north",
"travel in the direction of the north": "go north",
"take the road north": "go north",
"continue walking north": "go north",
"set off toward the north": "go north",
"proceed north on the trail": "go north",
"head north along the path": "go north",
"move north along the road": "go north",
"head for the north": "go north",
"start toward the north": "go north",
"continue onward north": "go north",
"take the northern path": "go north",
"keep moving north": "go north",
"head south": "go south",
"south": "south",
"s": "south",
"move south": "go south",
"proceed southward": "go south",
"walk to the south": "go south",
"make your way south": "go south",
"travel south": "go south",
"advance south": "go south",
"continue south": "go south",
"march south": "go south",
"step south": "go south",
"turn south": "go south",
"venture south": "go south",
"head towards the south": "go south",
"move in a southerly direction": "go south",
"proceed toward the south": "go south",
"go in the direction of south": "go south",
"walk southward": "go south",
"journey south": "go south",
"step towards the south": "go south",
"press on south": "go south",
"head off south": "go south",
"wander south": "go south",
"push south": "go south",
"march toward the south": "go south",
"continue in the direction of south": "go south",
"proceed in the direction of south": "go south",
"move toward the southern horizon": "go south",
"walk off to the south": "go south",
"start walking south": "go south",
"turn to the south and go": "go south",
"head directly south": "go south",
"take the path south": "go south",
"move straight south": "go south",
"walk straight south": "go south",
"take steps south": "go south",
"move over to the south": "go south",
"stride south": "go south",
"navigate south": "go south",
"take your path south": "go south",
"begin heading south": "go south",
"start moving south": "go south",
"proceed in a southerly direction": "go south",
"head southward": "go south",
"tread south": "go south",
"travel in the direction of south": "go south",
"start your journey south": "go south",
"walk over to the south": "go south",
"continue your path south": "go south",
"make your way towards the south": "go south",
"shift south": "go south",
"progress south": "go south",
"stride toward the south": "go south",
"head off towards the south": "go south",
"walk south on the path": "go south",
"start walking toward the south": "go south",
"proceed to go south": "go south",
"push onward to the south": "go south",
"head in the direction of the south": "go south",
"keep going south": "go south",
"journey toward the south": "go south",
"walk forward south": "go south",
"start moving toward the south": "go south",
"continue forward to the south": "go south",
"set off to the south": "go south",
"make progress south": "go south",
"move toward the south side": "go south",
"head in a southerly direction": "go south",
"turn to the south and proceed": "go south",
"walk south across the path": "go south",
"venture toward the south": "go south",
"move to the south side": "go south",
"head straight toward the south": "go south",
"set your course south": "go south",
"step forward south": "go south",
"move south on the trail": "go south",
"move directly south": "go south",
"move southward": "go south",
"head on south": "go south",
"travel southward": "go south",
"journey in a southerly direction": "go south",
"start to head south": "go south",
"move ahead south": "go south",
"continue heading south": "go south",
"set out south": "go south",
"venture forth south": "go south",
"turn and walk south": "go south",
"proceed to the south side": "go south",
"march southward": "go south",
"walk south toward the horizon": "go south",
"move on south": "go south",
"make progress toward the south": "go south",
"travel in the direction of the south": "go south",
"take the road south": "go south",
"continue walking south": "go south",
"set off toward the south": "go south",
"proceed south on the trail": "go south",
"head south along the path": "go south",
"move south along the road": "go south",
"head for the south": "go south",
"start toward the south": "go south",
"continue onward south": "go south",
"take the southern path": "go south",
"keep moving south": "go south",
"take the book": "take book",
"grab the book": "take book",
"get the book": "take book",
"pick up the book": "take book",
"seize the book": "take book",
"snatch the book": "take book",
"collect the book": "take book",
"retrieve the book": "take book",
"grasp the book": "take book",
"hold the book": "take book",
"pick up that book": "take book",
"take hold of the book": "take book",
"acquire the book": "take book",
"lift the book": "take book",
"take the book from the shelf": "take book",
"grab the book from the shelf": "take book",
"get the book from the shelf": "take book",
"pick up the book from the shelf": "take book",
"snatch the book from the shelf": "take book",
"take that book": "take book",
"retrieve the book from the shelf": "take book",
"grasp the book from the shelf": "take book",
"hold onto the book": "take book",
"seize the book from the shelf": "take book",
"grab the book off the shelf": "take book",
"take the book off the shelf": "take book",
"get the book off the shelf": "take book",
"pick the book from the shelf": "take book",
"snatch the book off the shelf": "take book",
"grab the book from the shelves": "take book",
"take the book from the shelves": "take book",
"get the book from the shelves": "take book",
"pick up the book from the shelves": "take book",
"snatch the book from the shelves": "take book",
"take book": "take book",
"grasp the book from the shelves": "take book",
"hold the book from the shelves": "take book",
"seize the book from the shelves": "take book",
"grab the book off the shelves": "take book",
"take the book off the shelves": "take book",
"get the book off the shelves": "take book",
"pick the book from the shelves": "take book",
"snatch the book off the shelves": "take book",
"take a book": "take book",
"grab a book": "take book",
"get a book": "take book",
"pick up a book": "take book",
"seize a book": "take book",
"snatch a book": "take book",
"collect a book": "take book",
"retrieve a book": "take book",
"grasp a book": "take book",
"hold a book": "take book",
"pick up that book from the shelf": "take book",
"get a book from the shelf": "take book",
"grab a book from the shelf": "take book",
"retrieve a book from the shelf": "take book",
"hold onto the book from the shelf": "take book",
"seize a book from the shelf": "take book",
"snatch a book from the shelf": "take book",
"grab a book off the shelf": "take book",
"pick a book off the shelf": "take book",
"take a book off the shelf": "take book",
"get a book off the shelf": "take book",
"grab a book from the shelves": "take book",
"take a book from the shelves": "take book",
"get a book from the shelves": "take book",
"pick up a book from the shelves": "take book",
"snatch a book from the shelves": "take book",
"retrieve a book from the shelves": "take book",
"grasp a book from the shelves": "take book",
"hold a book from the shelves": "take book",
"seize a book from the shelves": "take book",
"grab a book off the shelves": "take book",
"take a book off the shelves": "take book",
"get a book off the shelves": "take book",
"pick a book from the shelves": "take book",
"snatch a book off the shelves": "take book",
"lift the book from the shelf": "take book",
"lift the book from the shelves": "take book",
"lift a book from the shelf": "take book",
"lift a book from the shelves": "take book",
"grab the book quickly from the shelf": "take book",
"take the book carefully from the shelf": "take book",
"snatch the book quickly off the shelf": "take book",
"retrieve the book carefully from the shelf": "take book",
"pick the book slowly from the shelf": "take book",
"take yarn": "take yarn",
"i": "inventory",
"x": "examine",
"put spoon in fireplace": "put spoon in fireplace",
"tie yarn to spoon": "tie yarn to spoon",
"fill jar": "fill jar",
"drop book": "drop book",
"pull yarn": "pull yarn"

};

// Initialize the OpenAI API client
const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY, // Make sure to set your OpenAI API key in environment variables
});

async function llmLookup(query: string): Promise<string> {
  try {
    console.log("Calling OpenAI with query:", query); // Log the call
    const response = await openai.chat.completions.create({
      model: "gpt-4", // Ensure this is a chat model
      messages: [
        { role: "system", content: "Paraphrase this sentence into a one or two word phrase suitable for a user input into an interactive fiction game.  one word is better than 2 words.  If the sentence contains the word look, only return the word look.  restrict the output to the following verbs: look, go, east, west, north, south, e, w, n, s, take, drink, open, examine, up, down, put (in), move, tie, inventory, fill, unlock, drop, pull.  restrict the outpur to the following nouns: book, yarn, jar, bench, fireplace, self, me, catseye, liquid, blue liquid, necklace, trap, ash trap, loom, door, refrigerator, spoon.  And restrict the output to the following rooms and spaces: living room, fireplace, hole, kitchen, refridgerator, counter, sitting room, shelves, hallway, bedroom, stairs, vent, boiler.  The only exceptions are two four word phrase:  put spoon in fireplace and tie yarn to spoon" },
        { role: "user", content: query }
      ],
      max_tokens: 50, // Adjust the token limit as needed
    });
    console.log("OpenAI response:", response); // Log the response
    if (response.choices && response.choices[0]) {
      return response.choices[0].message.content.trim();
    } else {
      throw new Error("No response from LLM");
    }
  } catch (error) {
    console.error("Error querying LLM:", error);
    return query; // Fallback to the original input in case of an error
  }
}

export class MichaelModifier implements FablerModifier {
  public async modifyOutput(systemOutput: string): Promise<string> {
    if (systemOutput.trim().startsWith('Huh?')) {
      return "Your special new error message here!" + '\n\n>';
    } else {
      return systemOutput;
    }
  }

  public async modifyInput(userInput: string): Promise<string> {
    console.log("User input received:", userInput); // Log the user input
    // Check input against data table
    if (dataTable[userInput]) {
      console.log("Input found in data table, returning:", dataTable[userInput]); // Log data table match
      return dataTable[userInput];
    }

    // If not found in dataTable, query the LLM
    const llmResponse = await llmLookup(userInput);
    console.log("LLM Response received:", llmResponse); // Log the LLM response
    return llmResponse;
  }
}
